<!DOCTYPE html>
<html lang="en">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="AngieLee" />



<meta name="description" content="上次的网络层前前后后花了两天半，顺利完结撒花~ 终于到爷最爱的运输层啦！（bushi">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络网课笔记-运输层">
<meta property="og:url" content="https://angielee233.github.io/2022/03/20/computerInternet-5/index.html">
<meta property="og:site_name" content="小黎的小窝">
<meta property="og:description" content="上次的网络层前前后后花了两天半，顺利完结撒花~ 终于到爷最爱的运输层啦！（bushi">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qezOfg.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qm9uFK.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qm9cT0.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qmChUP.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qmCXEq.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qmPn2D.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qmPuxe.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qmPYPf.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/20/qmiCJf.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qmrjPJ.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qmsKqf.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qm66Dx.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qmcus1.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qmjIDx.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qneKwF.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qneylt.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quJsxO.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quNBin.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quaIKK.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quryb6.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qus4FU.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qugOjH.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qu2srd.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quRVzD.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quR7lD.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quf94x.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quf1xS.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/qubxSA.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/21/quL5b6.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/22/qKRJvF.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/22/qK4JiR.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/22/qMe9US.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/22/qMmFIO.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/22/qMKclQ.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/22/qMK7pF.md.png">
<meta property="article:published_time" content="2022-03-20T08:40:05.833Z">
<meta property="article:modified_time" content="2022-03-22T07:30:35.761Z">
<meta property="article:author" content="AngieLee">
<meta property="article:tag" content="运输层">
<meta property="article:tag" content="端口号">
<meta property="article:tag" content="复用与分用">
<meta property="article:tag" content="TCP">
<meta property="article:tag" content="UDP">
<meta property="article:tag" content="流量控制">
<meta property="article:tag" content="拥塞控制">
<meta property="article:tag" content="超时重传时间选择">
<meta property="article:tag" content="三报文握手">
<meta property="article:tag" content="四报文挥手">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/03/20/qezOfg.md.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="小黎的小窝" type="application/atom+xml">



    <link rel="shortcut icon" href="/icon/USAO.jpg">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">




<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>计算机网络网课笔记-运输层 | 小黎的小窝</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<meta name="generator" content="Hexo 6.0.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/usao.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Angie Lee</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="/angielee@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" rel="noopener" href="https://github.com/AngieLee233" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" rel="noopener" href="https://www.zhihu.com/people/li-da-sha-45-40" title="知乎"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">感谢信收割机</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Angie Lee</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/usao.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Angie Lee</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="/angielee@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/AngieLee233" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/li-da-sha-45-40" title="知乎"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me"/>
</nav>
      <div class="body-wrap"><article id="post-computerInternet-5" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/03/20/computerInternet-5/" class="article-date">
      <time datetime="2022-03-20T08:40:05.833Z" itemprop="datePublished">2022-03-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      计算机网络网课笔记-运输层
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E9%BB%8E%E4%B8%8E%E8%AE%A1%E7%BD%91%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87/">小黎与计网的爱恨情仇</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TCP/" rel="tag">TCP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UDP/" rel="tag">UDP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%B8%89%E6%8A%A5%E6%96%87%E6%8F%A1%E6%89%8B/" rel="tag">三报文握手</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9B%9B%E6%8A%A5%E6%96%87%E6%8C%A5%E6%89%8B/" rel="tag">四报文挥手</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%8D%E7%94%A8%E4%B8%8E%E5%88%86%E7%94%A8/" rel="tag">复用与分用</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6/" rel="tag">拥塞控制</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/" rel="tag">流量控制</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AB%AF%E5%8F%A3%E5%8F%B7/" rel="tag">端口号</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4%E9%80%89%E6%8B%A9/" rel="tag">超时重传时间选择</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BF%90%E8%BE%93%E5%B1%82/" rel="tag">运输层</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>上次的网络层前前后后花了两天半，顺利完结撒花~</p>
<p>终于到爷最爱的运输层啦！（bushi</p>
<span id="more"></span>
<h1>概述</h1>
<ul>
<li>之前课程所介绍的计算机网络体系结构中的物理层、数据链路层以及网络层它们共同解决了将主机通过异构网络互联起来所面临的问题，实现了<strong>主机到主机的通信</strong>。</li>
<li>但实际上在计算机网络中进行<strong>通信的真正实体是位于通信两端主机中的进程</strong>。</li>
<li><strong>如何为运行在不同主机上的应用进程提供直接的通信服务是运输层的任务</strong>，运输层协议又称为端到端协议。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qezOfg"><img src="https://s1.ax1x.com/2022/03/20/qezOfg.md.png" alt="qezOfg.md.png"></a></p>
<p>运输层向高层用户屏蔽了下面网络核心的细节（如网络拓扑、所采用的路由选择协议等），它使应用进程看见的就<strong>好像是在两个运输层实体之间有一条端到端的逻辑通信信道</strong>。</p>
<p>根据应用需求的不同，<strong>因特网的运输层</strong>为应用层提供了两种不同的运输协议，即<strong>面向连接的TCP</strong>和<strong>无连接的UDP</strong>，这两种协议就是本章要讨论的主要内容。</p>
<h1>运输层端口号、复用与分用</h1>
<h2 id="端口号">端口号</h2>
<ul>
<li>运行在计算机上的进程使用<strong>进程标识符PID</strong>来标志。</li>
<li>因特网上的计算机并不是使用统一的操作系统，不同的操作系统（windows，Linux，Mac OS）又使用<strong>不同格式的进程标识符</strong>。</li>
<li>为了使运行不同操作系统的计算机的应用进程之间能够进行网络通信，就必须<strong>使用统一的方法对TCP/IP体系的应用进程进行标识</strong>。</li>
<li>TCP/IP体系的运输层使用<strong>端口号</strong>来区分应用层的不同应用进程。
<ul>
<li>端口号使用<strong>16比特</strong>表示，取值范围<strong>0~65535</strong>；
<ul>
<li><strong>熟知端口号</strong>：0~1023，IANA把这些端口号指派给了TCP/IP体系中最重要的一些应用协议，例如：FTP使用21/20，HTTP使用80，DNS使用53。</li>
<li><strong>登记端口号</strong>：1024~49151，为没有熟知端口号的应用程序使用。使用这类端口号必须在IANA按照规定的手续登记，以防止重复，例如：Microsoft RDP 微软远程桌面使用的端口是3389。</li>
<li><strong>短暂端口号</strong>：49152~65535，留给客户进程选择暂时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号。通信结束后，这个端口号可供其他客户进程以后使用。</li>
</ul>
</li>
<li><strong>端口号只具有本地意义</strong>，即端口号只是为了<strong>标识本计算机应用层中的各进程</strong>，在因特网中，<strong>不同计算机中的相同端口号是没有联系的</strong>。</li>
</ul>
</li>
</ul>
<h2 id="发送方的复用与接收方的分用">发送方的复用与接收方的分用</h2>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qm9uFK"><img src="https://s1.ax1x.com/2022/03/20/qm9uFK.md.png" alt="qm9uFK.md.png"></a></p>
<h2 id="TCP-IP体系的应用层常用协议所使用的运输层熟知端口号">TCP/IP体系的应用层常用协议所使用的运输层熟知端口号</h2>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qm9cT0"><img src="https://s1.ax1x.com/2022/03/20/qm9cT0.md.png" alt="qm9cT0.md.png"></a></p>
<h2 id="端口号应用举例">端口号应用举例</h2>
<p>如图所示，用户PC、DNS服务器、Web服务器通过交换机进行互联，它们处于同一个以太网中。假设Web服务器域名如图，DNS服务器中记录有该域名所对应的IP地址。</p>
<p>我们在用户PC中使用网页浏览器来访问Web服务器的内容，在网页浏览器的地址栏中输入Web服务器的域名。用户PC中的DNS客户端进程会发送一个DNS查询请求报文，其内容如图。</p>
<p>DNS查询请求报文需要使用运输层的UDP协议封装成UDP用户数据报，其首部中的源端口字段中的值在短暂端口号49151-65535挑选一个未被占用的用来标识客户端进程，例如49152。目的端口字段的值设置为53，这是DNS服务器端进程使用的熟知端口号。</p>
<p>之后将UDP用户数据报封装在IP数据报中通过以太网发送给DNS服务器。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmChUP"><img src="https://s1.ax1x.com/2022/03/20/qmChUP.md.png" alt="qmChUP.md.png"></a></p>
<p>DNS服务器收到该数据报后，从中解封出UDP用户数据报，UDP首部中的目的端口号为53，这表明应将UDP用户数据报的数据载荷部分，也就是DNS查询请求报文，交付给本服务器中的DNS服务器端进程。</p>
<p>DNS服务器端进程解析DNS查询请求报文的内容，然后按其要求查找对应的IP地址。之后，会给用户PC发送DNS响应报文，其内容如图。</p>
<p>DNS响应报文需要使用运输层的UDP协议封装成UDP用户数据报。其首部中的源端口字段的值设置为熟知端口号53，表明这是DNS服务器端进程所发送的UDP用户数据报。目的端口字段的值设置为49152，这是之前用户PC中发送DNS查询请求报文的DNS客户端进程所使用的短暂端口号。</p>
<p>之后，将UDP用户数据报封装在IP数据报中，通过以太网发送给用户PC。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmCXEq"><img src="https://s1.ax1x.com/2022/03/20/qmCXEq.md.png" alt="qmCXEq.md.png"></a></p>
<p>用户PC收到该数据报后，从中解封出UDP用户数据报。UDP首部中的目的端口号为49152，这表明应将该UDP用户数据报的数据载荷部分，也就是DNS响应报文，交付给用户PC中的DNS客户端进程。</p>
<p>DNS客户端进程解析DNS相应报文的内容，就可知道自己之前所请求的Web服务器的域名所对应的IP地址。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmPn2D"><img src="https://s1.ax1x.com/2022/03/20/qmPn2D.md.png" alt="qmPn2D.md.png"></a></p>
<p>现在，用户PC中的HTTP客户端进程可以向Web服务器发送HTTP请求报文了，其内容如图所示。</p>
<p>HTTP请求报文需要使用运输层的TCP协议封装成TCP报文段，其首部中的源端口字段的值在短暂端口号49151-65535中挑选一个未被占用的，用来标识HTTP客户端进程。例如仍然使用之前用过的49152，目的端口字段的值设置为80，这是HTTP服务器端进程所使用的熟知端口号。</p>
<p>之后将TCP报文段封装在IP数据报中，通过以太网发送给Web服务器。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmPuxe"><img src="https://s1.ax1x.com/2022/03/20/qmPuxe.md.png" alt="qmPuxe.md.png"></a></p>
<p>Web服务器收到该数据报后，从中解封出TCP报文段。TCP首部中的目的端口号为80，这表明应该将该TCP报文段的数据载荷部分，也就是HTTP请求报文，交付给本服务器中的HTTP服务器端进程。</p>
<p>HTTP服务器端进程解析HTTP请求报文的内容，然后按其要求查找首页内容。之后会给用户PC发送HTTP相应报文，其内容如图所示。HTTP相应报文需要使用运输层的TCP协议封装成TCP报文段，其首部中的源端口号字段的值设置为熟知端口号80，表明这是HTTP服务器端进程所发送的TCP报文段。目的端口字段的值设置为49152，这是之前用户PC中发送HTTP请求报文的HTTP客户端进程所使用的短暂端口号。</p>
<p>之后，将TCP报文段封装在IP数据报中，通过以太网发送给用户PC。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmPYPf"><img src="https://s1.ax1x.com/2022/03/20/qmPYPf.md.png" alt="qmPYPf.md.png"></a></p>
<p>用户PC收到该数据报后，从中解封出TCP报文段，TCP首部中的目的端口号为49152，这表明应该将该TCP报文段的数据载荷部分，也就是HTTP相应报文，交付给用户PC中的HTTP客户端进程。</p>
<p>HTTP客户端进程解析HTTP相应报文的内容，并在网页浏览器中进行显示。这样，我们就可以在网页浏览器中看到Web服务器所提供的首页内容了。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmiCJf"><img src="https://s1.ax1x.com/2022/03/20/qmiCJf.md.png" alt="qmiCJf.md.png"></a></p>
<h1>TCP和UDP的对比</h1>
<p>使用UDP协议的通信双方可以随时发送数据</p>
<p>使用TCP协议的通信双方在进行数据传输前，需要通过三报文握手建立TCP连接。TCP连接建立成功后才能进行数据传输。数据传输结束后，需要使用四报文挥手来释放TCP连接。</p>
<p>（这里的连接是指逻辑连接，而不是物理连接</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmrjPJ"><img src="https://s1.ax1x.com/2022/03/21/qmrjPJ.md.png" alt="qmrjPJ.md.png"></a></p>
<p>图中是使用UDP协议的四台主机，其中任意一个主机都可以向其他主机发送广播，也可以向某个多播组发送多播，还可以向某台主机发送单播。也就是说，UDP支持一对一、一对多和一对全的通信。</p>
<p>使用TCP协议的通信双方，在进行数据传输之前必须要使用三报文握手来建立连接，通信双方使用这条基于TCP连接的可靠信道进行通信。TCP仅支持单播，也就是一对一的通信。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmsKqf"><img src="https://s1.ax1x.com/2022/03/21/qmsKqf.md.png" alt="qmsKqf.md.png"></a></p>
<p>发送方的应用进程将应用层报文交付给运输层的UDP，UDP直接给应用层报文添加一个UDP首部，使之成为UDP用户数据报，然后进行发送。接收方的UDP收到该UDP用户数据报后，去掉UDP首部，将应用层报文交付给应用进程。也就是说，UDP对应用进程交下来的报文既不合并也不拆分，而是保留这些报文的边界。</p>
<p>发送方的TCP把应用进程交付下来的数据块仅仅看作是一连串的、无结构的字节流。TCP仅将字节流编号，并存储在自己的发送缓存中。TCP根据发送策略从发送缓存中提取一定数量的字节构造TCP报文段进行发送。接收方的TCP一方面从接收到的TCP报文段中，取出数据载荷部分并存储在接收缓存中，一方面将接收缓存中的一些字节交付给应用进程。TCP不保证接收方应用进程所收到的数据块与发送方应用进程所发出的数据块具有对应大小的关系。但接收方的应用进程收到的字节流必须和发送方应用进程发出的字节流完全一样。这是TCP实现可靠传输、流量控制、拥塞控制的基础。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qm66Dx"><img src="https://s1.ax1x.com/2022/03/21/qm66Dx.md.png" alt="qm66Dx.md.png"></a></p>
<p>当运输层使用UDP协议时，向上提供无连接的不可靠传输服务。</p>
<p>当运输层使用TCP协议时，向上提供面向连接的可靠传输服务。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmcus1"><img src="https://s1.ax1x.com/2022/03/21/qmcus1.md.png" alt="qmcus1.md.png"></a></p>
<p>由于UDP不提供可靠传输服务，它仅在网际层的基础上添加了用于区分应用进程的端口，因此首部非常简单，仅有8个字节。</p>
<p>TCP首部格式比UDP复杂得多，其最小长度为20字节，最大长度为60字节，因为TCP要实现可靠传输、流量控制、拥塞控制等服务，其首部自然会比较复杂。首部中的字段比较多、首部长度也比较长。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qmjIDx"><img src="https://s1.ax1x.com/2022/03/21/qmjIDx.md.png" alt="qmjIDx.md.png"></a></p>
<h1>TCP的流量控制</h1>
<ul>
<li>一般来说，我们总是希望数据传输得更快一些。
<ul>
<li>但如果发送方把数据发送得过快，接收方就可能来不及接收，这就会造成数据的丢失。</li>
</ul>
</li>
<li>所谓流量控制（flow control）就是<strong>让发送方的发送速率不要太快，要让接收方来得及接收</strong>。</li>
<li>利用<strong>滑动窗口</strong>机制可以很方便地在TCP连接上实现对发送方的流量控制。
<ul>
<li>TCP接收方利用自己的接收窗口的大小来限制发送方发送窗口的大小。</li>
<li>TCP发送方收到接收方的零窗口通知后，应启动持续计时器。持续计时器超时后，向接收方发送零窗口探测报文。</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qneKwF"><img src="https://s1.ax1x.com/2022/03/21/qneKwF.md.png" alt="qneKwF.md.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qneylt"><img src="https://s1.ax1x.com/2022/03/21/qneylt.md.png" alt="qneylt.md.png"></a></p>
<h1>TCP的拥塞控制</h1>
<ul>
<li>在某段时间，若<strong>对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏</strong>。这种情况就叫做<strong>拥塞</strong>（congestion）。
<ul>
<li>在计算机网络中的链路容量（即带宽）、交换结点中的缓存和处理机等，都是网络的资源。</li>
</ul>
</li>
<li>若<strong>出现拥塞而不进行控制</strong>，整个网络的<strong>吞吐量将随输入负荷的增大而下降</strong>。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quJsxO"><img src="https://s1.ax1x.com/2022/03/21/quJsxO.md.png" alt="quJsxO.md.png"></a></p>
<h2 id="拥塞控制算法">拥塞控制算法</h2>
<p>下面介绍四种拥塞控制算法的基本原理，假定如下条件：</p>
<ol>
<li>数据是单方向传送，而另一个方向只传送确认。</li>
<li>接收方总是有足够大的缓存空间，因而发送方发送窗口的大小由网络的拥塞程度来决定。</li>
<li>以最大报文段MSS的个数为讨论问题的单位，而不是以字节为单位。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quNBin"><img src="https://s1.ax1x.com/2022/03/21/quNBin.md.png" alt="quNBin.md.png"></a></p>
<ul>
<li>发送方维护一个叫做<strong>拥塞窗口cwnd</strong>的状态变量，其值<strong>取决于网络的拥塞程度</strong>，并且<strong>动态变化</strong>。
<ul>
<li>拥塞窗口<strong>cwnd的维护原则</strong>：只要网络<strong>没有出现拥塞</strong>，<strong>拥塞窗口</strong>就再<strong>增大</strong>一些；但只要网络<strong>出现拥塞</strong>，<strong>拥塞窗口就减少</strong>一些。</li>
<li>判断出现<strong>网络拥塞的依据</strong>：没有按时收到应当到达的确认报文（即发生<strong>超时重传</strong>）。</li>
</ul>
</li>
<li>发送方将拥塞窗口作为<strong>发送窗口swnd</strong>，即<strong>swnd＝cwnd</strong>。</li>
<li>维护一个慢开始门限<strong>ssthresh</strong>状态变量：
<ul>
<li>当cwnd＜ssthresh时，使用慢开始算法；</li>
<li>当cwnd＞ssthresh时，停止使用慢开始算法而改用拥塞避免算法：</li>
<li>当cwnd＝ssthresh时，既可使用慢开始算法，也可使用拥塞避免算法。</li>
</ul>
</li>
</ul>
<h3 id="慢开始（slow-star）和拥塞避免（congestion-avoidance）">慢开始（slow-star）和拥塞避免（congestion avoidance）</h3>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quaIKK"><img src="https://s1.ax1x.com/2022/03/21/quaIKK.md.png" alt="quaIKK.md.png"></a></p>
<ul>
<li>“慢开始”是指一开始向网络注入的报文段少，并不是指拥塞窗口cwnd增长速度慢；</li>
<li>“拥塞避免”并非指完全能够避免拥塞，而是指在拥塞避免阶段将拥塞窗口控制为按线性规律增长，使网络比较不容易出现</li>
</ul>
<h3 id="快重传（fast-retransmit）和快恢复（fast-recovery）">快重传（fast retransmit）和快恢复（fast recovery）</h3>
<ul>
<li>慢开始和拥塞避免算法是1988年提出的TCP拥塞控制算法（TCP Tahoe版本）ا</li>
<li>1990年又增加了两个新的拥塞控制算法（<strong>改进TCP的性能</strong>），这就是快重传和快恢复（TCP Reno版本）
<ul>
<li>有时，<strong>个别报文段</strong>会在网络中<strong>丢失</strong>，但实际上网络<strong>并未发生拥塞</strong>。
<ul>
<li>这将导致<strong>发送方</strong>超时重传，并<strong>误认为</strong>网络发生了<strong>拥塞</strong>；</li>
<li><strong>发送方把拥塞窗口cwnd又设置为最小值1</strong>，并错误地启动慢开始算法，因而<strong>降低了传输效率</strong>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="快重传算法">快重传算法</h4>
<ul>
<li>采用快重传算法可以<strong>让发送方尽早知道发生了个别报文段的丢失</strong>。</li>
<li>所谓快重传，就是使发送方<strong>尽快进行重传</strong>，而<strong>不是等超时重传计时器超时</strong>再重传。
<ul>
<li>要求接收方不要等待自己发送数据时才进行捎带确认，而是要<strong>立即发送确认</strong></li>
<li>即使收到了失序的报文段也要立即发出对已收到的报文段的<strong>重复确认</strong>。</li>
<li>发送方一旦<strong>收到3个连续的重复确认</strong>，就将相应的报文段<strong>立即重传</strong>，而不是等该报文段的超时重传计时器超时再重传。</li>
<li>对于个别丢失的报文段，发送方不会出现超时重传，也就不会误认为出现了拥塞（进而降低拥塞窗口cwnd为1），使用快重传可以使整个网络的吞吐量提高约20%。</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quryb6"><img src="https://s1.ax1x.com/2022/03/21/quryb6.md.png" alt="quryb6.md.png"></a></p>
<h4 id="快恢复算法">快恢复算法</h4>
<ul>
<li>发送方一旦<strong>收到3个重复确认</strong>，就知道现在只是丢失了个别的报文段。于是不启动慢开始算法，而<strong>执行快恢复算法</strong>
<ul>
<li><strong>发送方将慢开始门限ssthresh值和拥塞窗口cwnd值调整为当前窗口的一半；开始执行拥塞避免算法</strong>。</li>
<li>也有的快恢复实现是把快恢复开始时的拥塞窗口cwnd值再增大一些，即等于新的ssthresh＋3。
<ul>
<li>既然发送方收到3个重复的确认，就表明有3个数据报文段已经离开了网络：</li>
<li>这3个报文段不再消耗网络资源而是停留在接收方的接收缓存中；</li>
<li>可见现在网络中不是堆积了报文段而是减少了3个报文段。因此可以适当把拥塞窗口扩大些。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qus4FU"><img src="https://s1.ax1x.com/2022/03/21/qus4FU.md.png" alt="qus4FU.md.png"></a></p>
<h1>TCP超时重传时间的选择</h1>
<ul>
<li>超时重传时间的选择是TCP最复杂的问题之一
<ul>
<li>超时重传时间RTO小于往返时间RTT，会引起报文段不必要的重传，使网络负荷增大。</li>
<li>超时重传时间RTO的值远大于往返时间RTT，会使网络的空闲时间增大，降低了传输效率。</li>
<li>综合以上两种情况可以得出，超时重传时间RTO的值应略大于往返时间RTT的值。</li>
</ul>
</li>
<li><strong>不能直接使用某次测量得到的RTT样本来计算超时重传时间RTO</strong>。<s>（网络传输速率不是固定不变的，RTT这事潘子你把握不住</s><br>
<a target="_blank" rel="noopener" href="https://imgtu.com/i/qugOjH"><img src="https://s1.ax1x.com/2022/03/21/qugOjH.md.png" alt="qugOjH.md.png"></a></li>
</ul>
<h2 id="加权平均往返时间RTTs">加权平均往返时间RTTs</h2>
<ul>
<li>利用每次测量得到的RTT样本，计算<strong>加权平均往返时间RTTs</strong>（又称为平滑的往返时间）。
<ul>
<li>起初，<strong>RTTs1=RTT1</strong>,</li>
<li>之后的更新公式为：<strong>新的RTTs = (1-α)x 旧的RTTs + α x 新的RTT样本</strong></li>
<li>在上式中，0≤a＜1：
<ul>
<li>若α很接近于0，则新RTT样本对RTTs的影响不大；</li>
<li>若a很接近于1，则新RTT样本对RTTs的影响较大；</li>
</ul>
</li>
<li>已成为建议标准的RFC6298推荐的α值为1/8，即0.125。</li>
</ul>
</li>
<li>用这种方法得出的加权平均往返时间RTTs就比测量出的RTT值更加平滑。</li>
<li>显然，超时重传时间RTO应略大于加权平均往返时间RTTs。</li>
</ul>
<h2 id="RFC6298建议的超时重传时间RTO计算方法">RFC6298建议的超时重传时间RTO计算方法</h2>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qu2srd"><img src="https://s1.ax1x.com/2022/03/21/qu2srd.md.png" alt="qu2srd.md.png"></a></p>
<p>可以发现，RTTs和RTTD都是基于新的RTT样本进行计算的，如果测量到的样本不正确，那么计算出来的数值也不正确。然而往返时间RTT的测量是比较复杂的。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quRVzD"><img src="https://s1.ax1x.com/2022/03/21/quRVzD.md.png" alt="quRVzD.md.png"></a></p>
<p>从上图可以看出，当出现超时重传后，主机无法准确测量RTT。</p>
<h2 id="karn算法及其修正">karn算法及其修正</h2>
<ul>
<li>针对<strong>出现超时重传时无法测准往返时间RTT</strong>的问题，<strong>Karn</strong>提出了一个<strong>算法</strong>：<strong>在计算加权平均往返时间RTTs时，只要报文段重传了，就不采用其往返时间RTT样本</strong>。也就是出现重传时，不重新计算RTTs，进而超时重传时间RTO也不会重新计算。
<ul>
<li>这又引起了新的问题。设想出现这样的情况：报文段的时延突然增大了很多，并且之后很长一段时间都会保持这种时延。因此在原来得出的重传时间内，不会收到确认报文段。于是就重传报文段。但根据Karn算法，不考虑重传的报文段的往返时间样本。这样，超时重传时间就无法更新。这会导致报文段反复被重传。</li>
</ul>
</li>
<li>因此，要对<strong>Karn算法进行修正</strong>。方法是：<strong>报文段每重传一次，就把超时重传时间RTO增大一些</strong>。典型的做法是将新RTO的值取为旧RTO值的2倍。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quR7lD"><img src="https://s1.ax1x.com/2022/03/21/quR7lD.md.png" alt="quR7lD.md.png"></a></p>
<h1>TCP可靠传输的实现</h1>
<p>TCP基于<strong>以字节为单位的滑动窗口</strong>来实现可靠传输</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quf94x"><img src="https://s1.ax1x.com/2022/03/21/quf94x.md.png" alt="quf94x.md.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quf1xS"><img src="https://s1.ax1x.com/2022/03/21/quf1xS.md.png" alt="quf1xS.md.png"></a></p>
<p>（还有一个图没放上来，主要就是说接收方收到失序的数据，比如说当前想要31–51号的数据，但是收到了32和33，也就是31丢了。接收方不高兴了，说爷的31去哪了，于是发送ack给发送方。发送方收到后视若无睹，因为<s>真正的程序员从来不看warning</s>收到三次相同的重传请求才会进行重传，感觉可能缺失的数据堵路上啥的，这不一定是咱的问题啊，于是就继续发送后面的数据。过了一会接收方收到了它最爱的31号数据，很开心地告诉发送方自己收到了，发送ack说要34号数据。于是移动自己的滑动窗口，把31-33号数据交付给上层，然后把这些数据从自己的缓存里<s>拉出来</s>移出。接收方知道了发送方已经收到31-33号数据了，同样地移动滑动窗口，移出数据。如果发送方把自己滑动窗口内的所有数据都发送出去了，在收到接收方的确认之前都不会再移动窗口和发送数据。如果发送方一直等不到接收方的确认，就会<s>生气</s>超时重传，重新发送窗口内的数据。</p>
<p><s>知道为啥我不放图了吗，因为动画实在是太多了</s></p>
<ul>
<li>虽然发送方的发送窗口是根据接收方的接收窗口设置的，但在同一时刻，<strong>发送方的发送窗口并不总是和接收方的接收窗口一样大</strong>。
<ul>
<li>网络传送窗口值需要经历一定的时间滞后，并且这个时间还是不确定的。</li>
<li>发送方还可能根据网络当时的拥塞情况适当减小自己的发送窗口尺寸。</li>
</ul>
</li>
<li>对于<strong>不按序到达的数据应如何处理</strong>，TCP并无明确规定。
<ul>
<li>如果接收方把不按序到达的数据一律丢弃，那么接收窗口的管理将会比较简单，但这样做对网络资源的利用不利，因为发送方会重复传送较多的数据。</li>
<li>TCP通常对不按序到达的数据是先临时存放在接收窗口中，等到字节流中所缺少的字节收到后，再<strong>按序交付上层的应用进程</strong>。</li>
</ul>
</li>
<li>TCP要求接收方必须有<strong>累积确认和捎带确认机制</strong>，这样可以减小传输开销。接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上。
<ul>
<li><strong>接收方不应过分推迟发送确认</strong>，否则会导致发送方不必要的超时重传，这反而浪费了网络的资源。</li>
<li>TCP标准规定，确认推迟的时间不应超过0.5秒。若收到一连串具有最大长度的报文段，则必须每隔一个报文段就发送一个确认［RFC 1122］。</li>
<li>捎带确认实际上并不经常发生，因为大多数应用程序很少同时在两个方向上发送数据。</li>
</ul>
</li>
<li><strong>TCP的通信是全双工通信</strong>。通信中的每一方都在发送和接收报文段。因此，每一方都有自己的发送窗口和接收窗口。在谈到这些窗口时，一定要弄清楚是哪一方的窗口。</li>
</ul>
<h1>TCP的运输连接管理</h1>
<ul>
<li>TCP是面向连接的协议，它基于运输连接来传送TCP报文段。</li>
<li>TCP运输连接的建立和释放是每一次面向连接的通信中必不可少的过程。</li>
<li>TCP运输连接有以下三个阶段：
<ol>
<li>“三报文握手”建立TCP连接</li>
<li>数据传送</li>
<li>“四报文挥手”释放TCP连接</li>
</ol>
</li>
<li>TCP的运输连接管理就是使运输连接的建立和释放都能正常地进行。</li>
</ul>
<h2 id="TCP的连接建立">TCP的连接建立</h2>
<ul>
<li>TCP的连接建立要解决以下三个问题：
<ol>
<li>使TCP双方能够确知对方的存在；</li>
<li>使TCP双方能够协商一些参数（如最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等）；</li>
<li>使TCP双方能够对运输实体资源（如缓存大小、连接表中的项目等）进行分配。</li>
</ol>
</li>
</ul>
<h3 id="“三报文握手”建立连接过程">“三报文握手”建立连接过程</h3>
<p>假设两台要基于TCP进行通信的主机，其中一台主机中的某应用进程主动发起TCP连接建立，称为TCP客户，另一台主机中被动等待TCP连接建立的应用进程，称为TCP服务器。我们可以将TCP建立连接的过程比喻为<strong>握手</strong>，握手需要在TCP客户和服务器之间<strong>交换三个TCP报文段</strong>。</p>
<p>最初，两端的TCP进程都处于<strong>关闭状态</strong>。一开始，TCP服务器进程首先<strong>创建传输控制块</strong>，用来存储TCP连接中的一些重要信息，例如TCP连接表、指向发送和接收缓存的指针、指向重传队列的指针、当前发送和接收序号等。之后，就<strong>准备接受TCP客户进程的连接请求</strong>。此时，TCP服务器进程就进入<strong>监听状态</strong>，等待TCP客户进程的连接请求。TCP服务器进程是<strong>被动等待来自TCP客户进程的连接请求</strong>，而不是主动发起。因此称为<strong>被动打开连接</strong>。</p>
<p>TCP客户进程也是<strong>首先创建传输控制块</strong>，然后在打算建立TCP连接时向TCP服务器进程发送<strong>TCP连接请求报文段</strong>，并进入<strong>同步已发送状态</strong>。TCP连接请求报文段首部中的<strong>同步位SYN被设置为1，表明这是一个TCP连接请求报文段</strong>。序号字段seq被设置为一个初始值x作为TCP客户进程所选择的初始序号。请注意：TCP规定<strong>SYN被设置为1的报文段不能携带数据，但要消耗掉一个序号</strong>。由于TCP连接建立是由TCP客户进程主动发起的，因此称为<strong>主动打开连接</strong>。</p>
<p>TCP服务器进程收到TCP连接请求报文段后，如果同意建立连接，则向TCP客户进程发送<strong>TCP连接请求确认报文段</strong>，并进入<strong>同步已接收状态</strong>。该报文段首部中的同步位<strong>SYN和确认位ACK都设置为1，表明这是一个TCP连接请求确认报文段</strong>。序号字段seq被设置为一个初始值y作为TCP服务器进程所选择的初始序号。确认号字段ack的值被设置成了x+1，这是对TCP客户进程所选择的初始序号的确认。请注意：这<strong>个报文段也不能携带数据，因为它是SYN被设置为1的报文段</strong>，但同样要消耗掉一个序号。</p>
<p>TCP客户进程收到TCP连接请求确认报文段后，<strong>还要向TCP服务器进程发送一个普通的TCP确认报文段</strong>，并进入<strong>连接已建立状态</strong>。该报文段首部中的确认位<strong>ACK被设置为1，表明这是一个普通的TCP确认报文段</strong>。序号字段seq被设置为x+1，这是因为TCP客户进程发送的第一个TCP报文段的序号为x，并且不携带数据，因此第二个报文段的序号为x+1。请注意：<strong>TCP规定普通的TCP确认报文段可以携带数据</strong>。但如果<strong>不携带数据，则不消耗序号</strong>。在这种情况下，所发送的下一个数据报文段的序号仍是x+1。确认号字段ack被设置为y+1，这是对TCP服务器进程所选择的初始序号的确认。</p>
<p>TCP服务器进程收到该确认报文段后，也进入连接已建立状态。现在，TCP双方都进入了连接已建立状态，它们可以基于已建立好的TCP连接进行可靠的数据传输了。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qubxSA"><img src="https://s1.ax1x.com/2022/03/21/qubxSA.md.png" alt="qubxSA.md.png"></a></p>
<h3 id="“两报文握手”不可行的原因">“两报文握手”不可行的原因</h3>
<p>假设使用两报文握手，此时TCP客户端进程一开始发送了一个TCP请求报文，但是由于网络状态不佳没有及时发送出去，TCP客户端进程<s>按捺不住</s>超时重传TCP报文，之后TCP服务器进程顺利收到了该TCP报文，于是快快乐乐地建立连接、传输数据、释放连接。此时最开始的<s>怨种</s>TCP报文弯弯绕绕终于到达了TCP服务器，之后TCP服务器以为还要再来一次，告诉TCP客户端进程<s>派大星我们去抓水母吧！我准备好了我准备好了</s>自己进入已连接状态，TCP客户端进程觉得莫名其妙<s>进入章鱼哥状态</s>不予理睬。这个时候TCP服务器进程一直星星眼地等待TCP客户端进程发送数据<s>但是到头来只是一个舔狗罢了</s>，导致<s>TCP服务器进程被伤透了心</s>资源被大量浪费。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/quL5b6"><img src="https://s1.ax1x.com/2022/03/21/quL5b6.md.png" alt="quL5b6.md.png"></a></p>
<p>综上所述，<s>努力的结果可能只是让事情变得更糟</s>采用三报文握手而不是两报文握手来建立TCP连接，是为了防止<s>世界上多一个怨种</s>已失效的连接请求报文段突然又传送到了TCP服务器进程，因而导致错误。</p>
<h2 id="TCP的连接释放">TCP的连接释放</h2>
<h3 id="“四报文挥手”释放连接过程">“四报文挥手”释放连接过程</h3>
<p>假设TCP客户进程的应用进程通知其主动关闭TCP连接，TCP客户进程会<strong>发送TCP连接释放报文段</strong>，并进入<strong>终止等待1状态</strong>。该报文段首部中的<strong>终止位FIN和确认位ACK的值都被设置为1</strong>，表明这是一个<strong>TCP连接释放报文段</strong>，同时也对之前收到的报文段进行确认。序号seq字段的值设置为u，它等于TCP客户进程之前已传送过的数据的最后一个字节的序号+1。请注意：<strong>TCP规定终止位FIN等于1的报文段即使不携带数据，也要消耗掉一个序号</strong>。确认号ack字段的值设置为v，它等于TCP客户进程之前已收到的数据的最后一个字节的序号+1。</p>
<p><s>太长不看：TCP客户进程不想喜欢TCP服务器进程了，发脾气了</s></p>
<p>TCP服务器进程收到TCP连接释放报文段后，会发送一个<strong>普通的TCP确认报文段</strong>并<strong>进入关闭等待状态</strong>。该报文段首部中的确认位<strong>ACK的值被设置为1</strong>，表明这是一个<strong>普通的TCP确认报文段</strong>。序号seq字段的值设置为v，它等于TCP服务器进程之前已传送过的数据的最后一个字节的序号+1。这也与之前收到的TCP连接释放报文段中的确认号匹配。确认号ack字段的值设置为u+1，这是对TCP连接释放报文段的确认。TCP服务器进程这时应通知高层应用进程：TCP用户进程要断开与自己的TCP连接。此时，<strong>从TCP客户进程到TCP服务器进程这个方向的连接就释放了</strong>。</p>
<p><s>太长不看：TCP服务器进程知道人家不开心，去哄人家，但是人家是个直男让TCP客户进程更生气了，于是TCP客户进程直接和TCP服务器进程冷战了</s></p>
<p>这时的<strong>TCP连接处于半关闭状态</strong>，也就是<strong>TCP客户进程已经没有数据要发送了，但TCP服务器进程如果还有数据要发送，TCP客户进程仍要接收</strong>。也就是说，<strong>从TCP服务器进程到TCP客户进程这个方向的连接并未关闭</strong>。这个状态可能会持续一段时间。TCP客户进程收到TCP确认报文段后，就进入终止等待2状态。等待TCP服务器进程发出的TCP连接释放报文段。</p>
<p><s>太长不看：虽然TCP客户进程和TCP服务器进程冷战了，但是还没删联系方式，TCP服务器进程还能骚扰人家。TCP客户进程就等这个b啥时候能结束</s></p>
<p>若使用TCP服务器进程的应用进程已经<strong>没有数据要发送了，应用进程就通知其服务器进程释放连接</strong>。由于TCP连接释放是由TCP客户进程主动发起的，因此TCP服务器进程对TCP连接的释放称为<strong>被动关闭连接</strong>。TCP服务器进程发送<strong>TCP连接释放报文段</strong>并进入<strong>最后确认状态</strong>，该报文段首部中的<strong>终止位FIN和确认位ACK的值都被设置为1</strong>，表明这是一个<strong>TCP连接释放报文段</strong>，同时也对之前收到的报文段进行确认。现在假定seq字段的值为w。这时因为在半关闭状态下TCP服务器进程可能又发送了一些数据。确认号ack字段的值为u+1，这是对之前收到的TCP连接释放报文段的重复确认。</p>
<p><s>太长不看：TCP服务器进程骚扰不动了，累了，说咱就这样吧</s></p>
<p>TCP客户进程收到TCP连接释放报文段后，必须针对该报文段发送<strong>普通的TCP确认报文段</strong>，之后进入<strong>时间等待状态</strong>。该报文段首部中的确认位<strong>ACK的值被设置为1</strong>，表明这是一个普通的TCP确认报文段。序号seq字段的值设置为u+1，这是因为TCP客户进程之前发送的TCP连接释放报文段虽然不携带数据，但要消耗掉一个序号。确认号ack字段的值设置为w+1，这时对所收到的TCP连接释放报文段的确认。TCP服务器进程收到该报文段后，就进入关闭状态。</p>
<p><s>太长不看：TCP客户进程答应了，TCP服务器进程感觉没有挽回余地了就撤了准备投入下一个应用进程的怀抱（不是</s></p>
<p>而TCP客户进程还要<strong>经过两倍的MSL后才能进入关闭状态</strong>。MSL的意思是最长报文段寿命，RFC793文档建议为两分钟。也就是说TCP客户进程进入时间等待状态后，还要经过四分钟才能进入关闭状态，这完全是从工程上来考虑的。对于现在的网络，MSL取为2分钟可能太长，因此TCP允许不同的时限，可根据具体情况使用更小的MSL值。</p>
<p><s>太长不看：TCP客户进程以为对方会挽留自己，等啊等啊等啊等，结果发现自己只是个怨种，也不干了投入下一个TCP服务器进程的怀抱（没有</s></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qKRJvF"><img src="https://s1.ax1x.com/2022/03/22/qKRJvF.md.png" alt="qKRJvF.md.png"></a></p>
<h3 id="设置时间等待状态的原因">设置时间等待状态的原因</h3>
<p>如果TCP客户进程没有设置停止等待时间<s>也就是不存对方来挽留自己的幻想</s>，如果在TCP服务器进程处于最后确认时期，TCP客户进程发送的TCP确认报文丢失了<s>也就是TCP服务器进程没有等来对方的回应</s>。这时TCP客户进程已经<s>另寻新欢</s>进入关闭状态，而TCP服务器进程一直在苦苦地等待回应，不停地<s>骚扰人家</s>超时重传，但是TCP客户进程<s>想着哪来的舔狗真下头</s>不对该报文段进行回应，而TCP服务进程一直无法进入关闭状态。</p>
<p><s>所以舔狗不得house</s></p>
<p>因此，时间等待状态以及处于该状态2倍MSL的时长可以<strong>确保TCP服务器进程可以收到最后一个TCP确认报文段而进入关闭状态</strong>。另外，TCP客户进程在发送完最后一个TCP确认报文段后，再经过2MSL时长就可以<strong>使本次连接持续时间内所产生的所有报文段都从网络中消失</strong>，这样就可以使<strong>下一个新的TCP连接中不会出现旧连接中的报文段</strong>。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qK4JiR"><img src="https://s1.ax1x.com/2022/03/22/qK4JiR.md.png" alt="qK4JiR.md.png"></a></p>
<h3 id="保活计时器">保活计时器</h3>
<p>设想一种情况：TCP双方已经建立了连接，后来TCP客户进程所在的主机突然出现了故障。显然，TCP服务器进程以后就不能再收到TCP客户进程发来的数据。因此，应当有措施使TCP服务器进程不要再白白等待下去。换句话说，TCP服务器进程应该如何发现这种情况？方法就是使用保活计时器。</p>
<ul>
<li>TCP服务器进程每收到一次TCP客户进程的数据，就重新设置并启动<strong>保活计时器</strong>（2小时定时）</li>
<li>若保活计时器定时周期内未收到TCP客户进程发来的数据，则<strong>当保活计时器到时后，TCP服务器进程就向TCP客户进程发送一个探测报文段</strong>，以后则每隔75秒钟发送一次。若一连发送10个探测报文段后仍无TCP客户进程的响应，TCP服务器进程就认为TCP客户进程所在主机出了故障，接着就关闭这个连接。</li>
</ul>
<p><s>也就是定期检测对方还活着，如果没有就赶紧跑路吧不要在一棵树上吊死</s></p>
<h1>TCP报文段的首部格式</h1>
<ul>
<li>为了实现可靠传输，TCP采用了<strong>面向字节流</strong>的方式。</li>
<li>但TCP在发送数据时，是从发送缓存取出一部分或全部字节并给其添加一个首部使之成为<strong>TCP报文段</strong>后进行发送。
<ul>
<li>一个TCP报文段由<strong>首部</strong>和<strong>数据载荷</strong>两部分构成；</li>
<li>TCP的全部功能都体现在它首部中各字段的作用。</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qMe9US"><img src="https://s1.ax1x.com/2022/03/22/qMe9US.md.png" alt="qMe9US.md.png"></a></p>
<h2 id="源端口字段">源端口字段</h2>
<ul>
<li>占16比特，写入源端口号</li>
<li>用来<strong>标识发送该TCP报文段的应用进程</strong>。</li>
</ul>
<h2 id="目的端口字段">目的端口字段</h2>
<ul>
<li>目的端口：占16比特，写入目的端口号</li>
<li>用来<strong>标识接收该TCP报文段的应用进程</strong>。</li>
</ul>
<h2 id="序号字段">序号字段</h2>
<ul>
<li>占32比特，取值范围$[0,2^{32}—1]$，序号增加到最后一个后，下一个序号就又回到0。<strong>指出本TCP报文段数据载荷的第一个字节的序号。</strong><br>
<a target="_blank" rel="noopener" href="https://imgtu.com/i/qMmFIO"><img src="https://s1.ax1x.com/2022/03/22/qMmFIO.md.png" alt="qMmFIO.md.png"></a></li>
</ul>
<h2 id="确认号字段">确认号字段</h2>
<ul>
<li>占32比特，取值范围$[0,2^{32}—1]$，确认号增加到最后一个后，下一个确认号就又回到0。</li>
<li><strong>指出期望收到对方下一个TCP报文段的数据载荷的第一个字节的序号，同时也是对之前收到的所有数据的确认。</strong></li>
<li>若确认号=n，则表明<strong>到序号n-1为止的所有数据都已正确接收</strong>，期望<strong>接收序号为n的数据</strong>。</li>
</ul>
<h2 id="确认标志位ACK字段">确认标志位ACK字段</h2>
<ul>
<li>取值为1时确认号字段才有效；取值为0时确认号字段无效。</li>
<li><strong>TCP规定，在连接建立后所有传送的TCP报文段都必须把ACK置1</strong>。</li>
</ul>
<h2 id="数据偏移字段">数据偏移字段</h2>
<ul>
<li>占4比特，并以4字节为单位。</li>
<li><strong>用来指出TCP报文段的数据载荷部分的起始处距离TCP报文段的起始处有多远。</strong></li>
<li>这个字段实际上是指出了<strong>TCP报文段的首部长度</strong>。
<ul>
<li>首部固定长度为20字节，因此数据偏移字段的最小值为$(0101)_2$</li>
<li>首部最大长度为60字节，因此数据偏移字段的最大值为$(1111)_2$</li>
</ul>
</li>
</ul>
<h2 id="保留字段">保留字段</h2>
<ul>
<li>占6比特，保留为今后使用，但目前置为0</li>
</ul>
<p><s>果然人类都是喜欢为不确定的未来做点确定的无用功</s></p>
<h2 id="窗口字段">窗口字段</h2>
<ul>
<li>占16比特，以字节为单位。<strong>指出发送本报文段的一方的接收窗口</strong>。</li>
<li>窗口值作为接收方<strong>让发送方设置其发送窗口的依据</strong>。</li>
<li>这是<strong>以接收方的接收能力来控制发送方的发送能力</strong>，称为流量控制。</li>
</ul>
<p>（发送窗口的大小还取决于拥塞窗口的大小，取接收窗口和拥塞窗口的小者</p>
<h2 id="校验和字段">校验和字段</h2>
<ul>
<li>占16比特，检查范围包括TCP报文段的首部和数据载荷两部分。</li>
<li>在计算校验和时，要在TCP报文段的前面加上12字节的伪首部。</li>
</ul>
<h2 id="同步标志位SYN">同步标志位SYN</h2>
<ul>
<li>在TCP连接建立时用来同步序号</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qMKclQ"><img src="https://s1.ax1x.com/2022/03/22/qMKclQ.md.png" alt="qMKclQ.md.png"></a></p>
<h2 id="终止标志位FIN">终止标志位FIN</h2>
<p>用来释放TCP连接</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/qMK7pF"><img src="https://s1.ax1x.com/2022/03/22/qMK7pF.md.png" alt="qMK7pF.md.png"></a></p>
<h2 id="复位标志位RST">复位标志位RST</h2>
<ul>
<li>用来复位TCP连接。</li>
<li>当<strong>RST=1时，表明TCP连接出现了异常</strong>，必须释放连接，然后再重新建立连接。</li>
<li>RST置1还用来<strong>拒绝一个非法的报文段</strong>或<strong>拒绝打开一个TCP连接</strong>。</li>
</ul>
<h2 id="推送标志位PSH">推送标志位PSH</h2>
<p>接收方的TCP收到该标志位为1的报文段会<strong>尽快上交应用进程</strong>，而不必等到接收缓存都填满后再向上交付。</p>
<h2 id="紧急标志位URG、紧急指针字段">紧急标志位URG、紧急指针字段</h2>
<p>用于实现紧急操作</p>
<ul>
<li>紧急标志位URG：取值为1时紧急指针字段有效；取值为0时紧急指针字段无效。</li>
<li>紧急指针：占16比特，以字节为单位，用来指明紧急数据的长度。</li>
</ul>
<p>当发送方有紧急数据时，可将紧急数据插队到发送缓存的最前面，并立刻封装到一个TCP报文段中进行发送。紧急指针会指出本报文段数据载荷部分包含了多长的紧急数据，紧急数据之后是普通数据。</p>
<p>接收方收到紧急标志为1的报文段，会按照紧急指针字段的值从报文段数据载荷部分取出紧急数据，并直接上交应用进程，而不必在接收缓存中排队。</p>
<h2 id="选项字段">选项字段</h2>
<p>增加选项可以增加TCP的功能，目前有以下选项：</p>
<ul>
<li>最大报文段长度MSS选项：用于指出TCP报文段数据载荷部分的最大长度。</li>
<li>窗口扩大选项：为了扩大窗口（提高吞吐率）。</li>
<li>时间戳选项：
<ul>
<li>用来计算往返时间RTT</li>
<li>用于处理序号超范围的情况，又称为防止序号绕回PAWS。</li>
</ul>
</li>
<li>选择确认选项：用来实现选择确认功能。</li>
</ul>
<h2 id="填充字段">填充字段</h2>
<p>由于选项的长度可变，因此使用填充来<strong>确保报文段首部能被4整除</strong>（因为数据偏移字段，也就是首部长度字段，是以4字节为单位的）。</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>Title:</span><a href="/2022/03/20/computerInternet-5/">计算机网络网课笔记-运输层</a></p>
        <p><span>Author:</span><a href="/" title="Back to Homepage">Angie Lee</a></p>
        <p><span>Created:</span>2022-03-20, 16:40:05</p>
        <p><span>Updated:</span>2022-03-22, 15:30:35</p>
        <p>
            <span>Full URL:</span><a class="post-url" href="/2022/03/20/computerInternet-5/" title="计算机网络网课笔记-运输层">https://angielee233.github.io/2022/03/20/computerInternet-5/</a>
            <span class="copy-path" data-clipboard-text="From https://angielee233.github.io/2022/03/20/computerInternet-5/　　By Angie Lee" title="Copy Article&#39;s Link &amp; Author"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>License:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"CC BY-NC-SA 4.0"</a> Keep Link &amp; Author if Distribute.
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2022/03/22/computerInternet-6/">
                    计算机网络网课笔记-应用层
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2022/03/18/computerInternet-4/">
                    计算机网络网课笔记-网络层
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">运输层端口号、复用与分用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">2.1.</span> <span class="toc-text">端口号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%96%B9%E7%9A%84%E5%A4%8D%E7%94%A8%E4%B8%8E%E6%8E%A5%E6%94%B6%E6%96%B9%E7%9A%84%E5%88%86%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">发送方的复用与接收方的分用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-IP%E4%BD%93%E7%B3%BB%E7%9A%84%E5%BA%94%E7%94%A8%E5%B1%82%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE%E6%89%80%E4%BD%BF%E7%94%A8%E7%9A%84%E8%BF%90%E8%BE%93%E5%B1%82%E7%86%9F%E7%9F%A5%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">2.3.</span> <span class="toc-text">TCP&#x2F;IP体系的应用层常用协议所使用的运输层熟知端口号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%8F%B7%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-number">2.4.</span> <span class="toc-text">端口号应用举例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">TCP和UDP的对比</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">TCP的流量控制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">TCP的拥塞控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95"><span class="toc-number">5.1.</span> <span class="toc-text">拥塞控制算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E5%BC%80%E5%A7%8B%EF%BC%88slow-star%EF%BC%89%E5%92%8C%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D%EF%BC%88congestion-avoidance%EF%BC%89"><span class="toc-number">5.1.1.</span> <span class="toc-text">慢开始（slow-star）和拥塞避免（congestion avoidance）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%87%8D%E4%BC%A0%EF%BC%88fast-retransmit%EF%BC%89%E5%92%8C%E5%BF%AB%E6%81%A2%E5%A4%8D%EF%BC%88fast-recovery%EF%BC%89"><span class="toc-number">5.1.2.</span> <span class="toc-text">快重传（fast retransmit）和快恢复（fast recovery）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%87%8D%E4%BC%A0%E7%AE%97%E6%B3%95"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">快重传算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E6%81%A2%E5%A4%8D%E7%AE%97%E6%B3%95"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">快恢复算法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">TCP超时重传时间的选择</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E6%9D%83%E5%B9%B3%E5%9D%87%E5%BE%80%E8%BF%94%E6%97%B6%E9%97%B4RTTs"><span class="toc-number">6.1.</span> <span class="toc-text">加权平均往返时间RTTs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RFC6298%E5%BB%BA%E8%AE%AE%E7%9A%84%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4RTO%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">RFC6298建议的超时重传时间RTO计算方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#karn%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E4%BF%AE%E6%AD%A3"><span class="toc-number">6.3.</span> <span class="toc-text">karn算法及其修正</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">TCP可靠传输的实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">TCP的运输连接管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B"><span class="toc-number">8.1.</span> <span class="toc-text">TCP的连接建立</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9C%E4%B8%89%E6%8A%A5%E6%96%87%E6%8F%A1%E6%89%8B%E2%80%9D%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B"><span class="toc-number">8.1.1.</span> <span class="toc-text">“三报文握手”建立连接过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9C%E4%B8%A4%E6%8A%A5%E6%96%87%E6%8F%A1%E6%89%8B%E2%80%9D%E4%B8%8D%E5%8F%AF%E8%A1%8C%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">8.1.2.</span> <span class="toc-text">“两报文握手”不可行的原因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E7%9A%84%E8%BF%9E%E6%8E%A5%E9%87%8A%E6%94%BE"><span class="toc-number">8.2.</span> <span class="toc-text">TCP的连接释放</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9C%E5%9B%9B%E6%8A%A5%E6%96%87%E6%8C%A5%E6%89%8B%E2%80%9D%E9%87%8A%E6%94%BE%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B"><span class="toc-number">8.2.1.</span> <span class="toc-text">“四报文挥手”释放连接过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%B6%E9%97%B4%E7%AD%89%E5%BE%85%E7%8A%B6%E6%80%81%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">8.2.2.</span> <span class="toc-text">设置时间等待状态的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E6%B4%BB%E8%AE%A1%E6%97%B6%E5%99%A8"><span class="toc-number">8.2.3.</span> <span class="toc-text">保活计时器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">TCP报文段的首部格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%AB%AF%E5%8F%A3%E5%AD%97%E6%AE%B5"><span class="toc-number">9.1.</span> <span class="toc-text">源端口字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%AD%97%E6%AE%B5"><span class="toc-number">9.2.</span> <span class="toc-text">目的端口字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E5%8F%B7%E5%AD%97%E6%AE%B5"><span class="toc-number">9.3.</span> <span class="toc-text">序号字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E5%8F%B7%E5%AD%97%E6%AE%B5"><span class="toc-number">9.4.</span> <span class="toc-text">确认号字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E6%A0%87%E5%BF%97%E4%BD%8DACK%E5%AD%97%E6%AE%B5"><span class="toc-number">9.5.</span> <span class="toc-text">确认标志位ACK字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%81%8F%E7%A7%BB%E5%AD%97%E6%AE%B5"><span class="toc-number">9.6.</span> <span class="toc-text">数据偏移字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E7%95%99%E5%AD%97%E6%AE%B5"><span class="toc-number">9.7.</span> <span class="toc-text">保留字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%AD%97%E6%AE%B5"><span class="toc-number">9.8.</span> <span class="toc-text">窗口字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E5%92%8C%E5%AD%97%E6%AE%B5"><span class="toc-number">9.9.</span> <span class="toc-text">校验和字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E6%A0%87%E5%BF%97%E4%BD%8DSYN"><span class="toc-number">9.10.</span> <span class="toc-text">同步标志位SYN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%88%E6%AD%A2%E6%A0%87%E5%BF%97%E4%BD%8DFIN"><span class="toc-number">9.11.</span> <span class="toc-text">终止标志位FIN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E4%BD%8D%E6%A0%87%E5%BF%97%E4%BD%8DRST"><span class="toc-number">9.12.</span> <span class="toc-text">复位标志位RST</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E9%80%81%E6%A0%87%E5%BF%97%E4%BD%8DPSH"><span class="toc-number">9.13.</span> <span class="toc-text">推送标志位PSH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A7%E6%80%A5%E6%A0%87%E5%BF%97%E4%BD%8DURG%E3%80%81%E7%B4%A7%E6%80%A5%E6%8C%87%E9%92%88%E5%AD%97%E6%AE%B5"><span class="toc-number">9.14.</span> <span class="toc-text">紧急标志位URG、紧急指针字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E9%A1%B9%E5%AD%97%E6%AE%B5"><span class="toc-number">9.15.</span> <span class="toc-text">选项字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A1%AB%E5%85%85%E5%AD%97%E6%AE%B5"><span class="toc-number">9.16.</span> <span class="toc-text">填充字段</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="Hide"  title="Show or Hide Table of Contents">

    <script>
        yiliaConfig.toc = ["Hide", "Show", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"计算机网络网课笔记-运输层　| 小黎的小窝　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2022/03/22/computerInternet-6/" title="Pre: 计算机网络网课笔记-应用层">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="Mini Archives"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2022/03/18/computerInternet-4/" title="Next: 计算机网络网课笔记-网络层">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/03/23/operatingSystem-1/">操作系统网课笔记-操作系统启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/22/computerInternet-6/">计算机网络网课笔记-应用层</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/20/computerInternet-5/">计算机网络网课笔记-运输层</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/18/computerInternet-4/">计算机网络网课笔记-网络层</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/serializeAndDeserializeBinaryTree/">二叉树的序列化与反序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/swapNodesInPairs/">两两交换链表中的节点</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/decodeWays/">解码方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/searchA2DMatrixII/">搜索二维矩阵II</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/combinationSum/">组合总和</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/copyListWithRandomPointer/">复制带随机指针的链表</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/longestPalindromicSubstring/">最长回文子串</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/minimumPathSum/">最小路径和</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/longestValidParentheses/">最长有效括号</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/generateParentheses/">括号生成</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/linkedListCycleII/">环形链表</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/mergeIntervals/">合并区间</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/findButtomLeftTreeValue/">找树左下角的值</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/excelSheetColumnTitle/">Excel表列名称</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/LRUCache/">LRU缓存</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/binaryTreeZigzagLevelOrderTraversal/">二叉树的锯齿形层序遍历</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/diameterOfBinaryTree/">二叉树的直径</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/3Sum/">三数之和</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/PermutationsII/">全排列II</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/courseSchedule/">课程表</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/08/searchInRotatedSortedArray/">搜索旋转排序数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/08/subarraySumEqualsK/">和为k的子数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/08/reverseWordsInString/">翻转字符串里的单词</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/08/longestSubstringWithoutRepeatingCharacters/">无重复字符的最大子串</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/08/rotateImage/">旋转图像</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/08/deleteNodeInBST/">删除二叉搜索树中的节点</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/08/maximumSubarray/">最大子数组和</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/07/lowestCommonAncestorOfABinaryTree/">二叉树的最近公共祖先</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/07/binaryTreeMaximumPathSum/">二叉树最大路径和</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/07/reverseList/">反转链表</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/07/kthBiggest/">数组中的第k个最大元素</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/01/center-img/">个人博客图片居中大法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/01/md-20220301/">关于MarkDown语法中加粗失效的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/28/computerInternet-3/">计算机网络网课笔记-数据链路层</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/27/computerInternet-2/">计算机网络网课笔记-物理层</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/26/computerInternet-1/">计算机网络网课笔记-概论</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/25/c++11/">C++11特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/25/x&(x-1)/">x&(x-1)的使用</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2022 AngieLee
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="Site Visitors"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="Page Hits"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg.webp)";
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>